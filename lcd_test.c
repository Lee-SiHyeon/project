/*
 * lcd_test.c
 *
 *  Created on: 2024. 7. 16.
 *      Author: yeeun99.kim
 */

#include "device_driver.h"
#include "lcd.h"
#include "lcd_test.h"
#include "game_object_queue.h"

#define Lcd_W 				320
#define Lcd_H 				240

#define PLANE_W 			30
#define PLANE_H 			30
#define PLANE_SIZE			208

#define MISSILE_W			8
#define MISSILE_H			8
#define MISSILE_SIZE		20

#define GAME_START			0
#define GAME_PLAYING		1
#define GAME_OVER			2

GameObject plane;

#define DIGIT_WIDTH 10
#define DIGIT_HEIGHT 14

GameObjectQueue missile_queue;
GameObjectQueue delete_missile_queue;

int score = 0;
int game_over = 0;
int game_level = 0;
int game_state_flag = 1;
int plane_move_flag = 0;
int before_plane_x;
int before_plane_y;

int level_delay[3] = {500, 300, 120};
int level_px_move[3] = {1, 3, 5};
int level_score[3] = {10, 30, 50};
int level_max_missiles[3] = {5, 10, 15};

extern volatile int key_value;

void Generate_Missile(GameObject *missile);
void Draw_Image(GameObject *obj, int size);
void Clear_Image(int x, int y, int w, int h, unsigned short Color);
void DrawPlane(void);
void ClearPlane(void);
void DrawMissile(GameObject* missile);
void ClearMissile(GameObject* missile);
void Game_Init(void);
void Game_Plane_Move(int dir);
void Game_Missile_Generation(void);
void Game_Missile_Move(void);
void Game_Over(void);
void Draw_LCD(void);
void Play_BGM(void);
void intToStr(int score, char *str);
void drawDigit(int x, int y, int digit);
void drawScore(int x, int y, int score);


const int Missile[MISSILE_SIZE][3] = {
	{1, 3, 0xFBE4}, {1, 4, 0xFBE4}, {2, 2, 0xFBE4}, {2, 3, 0xFBE4}, {2, 4, 0xFBE4}, {2, 5, 0xFBE4}, {3, 1, 0xFBE4}, 
	{3, 2, 0xFBE4}, {3, 5, 0xFBE4}, {3, 6, 0xFBE4}, {4, 1, 0xFBE4}, {4, 2, 0xFBE4}, {4, 5, 0xFBE4}, {4, 6, 0xFBE4}, 
	{5, 2, 0xFBE4}, {5, 3, 0xFBE4}, {5, 4, 0xFBE4}, {5, 5, 0xFBE4}, {6, 3, 0xFBE4}, {6, 4, 0xFBE4} 
};

const int Plane[PLANE_SIZE][3] = {
  	{4, 9, 0xB73D}, {4, 10, 0x5E3C}, {4, 11, 0x5E3D}, {4, 12, 0xB75E}, {5, 9, 0xD79E}, {5, 10, 0xD5C}, {5, 11, 0x55E}, {5, 12, 0x259C}, {5, 13, 0xE7BF}, 
	{6, 10, 0x769D}, {6, 11, 0x57D}, {6, 12, 0x55D}, {6, 13, 0x5E1D}, {7, 10, 0xDFBF}, {7, 11, 0x159D}, {7, 12, 0x5BE}, {7, 13, 0x55D}, {7, 14, 0x96FE}, 
	{8, 11, 0x767D}, {8, 12, 0x55E}, {8, 13, 0x59D}, {8, 14, 0x157D}, {8, 15, 0xCF9F}, {9, 11, 0xDFBF}, {9, 12, 0x159D}, {9, 13, 0x59E}, {9, 14, 0x57D}, 
	{9, 15, 0x45FD}, {10, 2, 0xC73D}, {10, 3, 0x4DDB}, {10, 4, 0x8EDD}, {10, 12, 0x769E}, {10, 13, 0x53D}, {10, 14, 0x5BE}, {10, 15, 0x55D}, {10, 16, 0x7E9E}, 
	{11, 2, 0xD7BF}, {11, 3, 0xD5D}, {11, 4, 0x53D}, {11, 5, 0x96DD}, {11, 12, 0xD7BF}, {11, 13, 0x157C}, {11, 14, 0x57E}, {11, 15, 0x59E}, {11, 16, 0x57D}, 
	{11, 17, 0xBF5F}, {12, 3, 0x667D}, {12, 4, 0x55E}, {12, 5, 0xD7D}, {12, 6, 0xA73E}, {12, 13, 0x7EDE}, {12, 14, 0x55D}, {12, 15, 0xD9D}, {12, 16, 0x59D}, 
	{12, 17, 0x2DBD}, {12, 18, 0xEFDF}, {13, 3, 0xBF5E}, {13, 4, 0xD5D}, {13, 5, 0x59E}, {13, 6, 0x157D}, {13, 7, 0x6E5D}, {13, 8, 0x767D}, {13, 9, 0x765C}, 
	{13, 10, 0x6E7C}, {13, 11, 0x6E7C}, {13, 12, 0x7E7C}, {13, 13, 0x563D}, {13, 14, 0x57E}, {13, 15, 0x59E}, {13, 16, 0x57F}, {13, 17, 0x55D}, {13, 18, 0x45FD}, 
	{13, 19, 0x767C}, {13, 20, 0x765D}, {13, 21, 0x765D}, {13, 22, 0x765D}, {13, 23, 0x765D}, {13, 24, 0x767D}, {13, 25, 0x8EBD}, {13, 26, 0xD79E}, {14, 4, 0x3DFD}, 
	{14, 5, 0x57D}, {14, 6, 0x59E}, {14, 7, 0x55E}, {14, 8, 0x55D}, {14, 9, 0x55D}, {14, 10, 0x55D}, {14, 11, 0x55E}, {14, 12, 0x55D}, {14, 13, 0x57E}, {14, 14, 0x57D}, 
	{14, 15, 0x59D}, {14, 16, 0x59D}, {14, 17, 0x59E}, {14, 18, 0x57D}, {14, 19, 0x55E}, {14, 20, 0x55D}, {14, 21, 0x55D}, {14, 22, 0x55D}, {14, 23, 0x55D}, {14, 24, 0x55D}, 
	{14, 25, 0x57D}, {14, 26, 0x155C}, {14, 27, 0xAF1E}, {15, 4, 0x3DFD}, {15, 5, 0x57D}, {15, 6, 0x59E}, {15, 7, 0x55E}, {15, 8, 0x55D}, {15, 9, 0x55D}, {15, 10, 0x55D}, 
	{15, 11, 0x55E}, {15, 12, 0x55D}, {15, 13, 0x57E}, {15, 14, 0x57D}, {15, 15, 0x59D}, {15, 16, 0x59D}, {15, 17, 0x59E}, {15, 18, 0x57D}, {15, 19, 0x55E}, {15, 20, 0x55D}, 
	{15, 21, 0x55D}, {15, 22, 0x55D}, {15, 23, 0x55D}, {15, 24, 0x55D}, {15, 25, 0x57D}, {15, 26, 0xD3C}, {15, 27, 0xAF1E}, {16, 3, 0xBF5F}, {16, 4, 0xD5D}, {16, 5, 0x59E}, 
	{16, 6, 0x157D}, {16, 7, 0x6E5D}, {16, 8, 0x767D}, {16, 9, 0x765C}, {16, 10, 0x6E7C}, {16, 11, 0x6E7C}, {16, 12, 0x7E7C}, {16, 13, 0x563D}, {16, 14, 0x57E}, {16, 15, 0x59E}, 
	{16, 16, 0x57F}, {16, 17, 0x55D}, {16, 18, 0x45FD}, {16, 19, 0x767C}, {16, 20, 0x765D}, {16, 21, 0x765D}, {16, 22, 0x765D}, {16, 23, 0x765D}, {16, 24, 0x767D}, {16, 25, 0x8EBD}, 
	{16, 26, 0xD79E}, {17, 3, 0x667D}, {17, 4, 0x55E}, {17, 5, 0xD5D}, {17, 6, 0xA73E}, {17, 13, 0x7EDE}, {17, 14, 0x55D}, {17, 15, 0xD9D}, {17, 16, 0x59D}, {17, 17, 0x2DBC}, 
	{17, 18, 0xEFDF}, {18, 2, 0xD7BF}, {18, 3, 0xD5D}, {18, 4, 0x53D}, {18, 5, 0x96DD}, {18, 12, 0xD7BF}, {18, 13, 0x157C}, {18, 14, 0x57E}, {18, 15, 0x59E}, {18, 16, 0x57D}, 
	{18, 17, 0xBF5F}, {19, 2, 0xC73D}, {19, 3, 0x4DDB}, {19, 4, 0x8EDD}, {19, 12, 0x769E}, {19, 13, 0x53D}, {19, 14, 0x5BE}, {19, 15, 0x55D}, {19, 16, 0x7E9E}, {20, 11, 0xDFBF}, 
	{20, 12, 0x159D}, {20, 13, 0x59E}, {20, 14, 0x57D}, {20, 15, 0x45FD}, {21, 11, 0x767D}, {21, 12, 0x55E}, {21, 13, 0x59D}, {21, 14, 0x157D}, {21, 15, 0xCF9F}, {22, 10, 0xDFBF}, 
	{22, 11, 0x159D}, {22, 12, 0x5BE}, {22, 13, 0x55D}, {22, 14, 0x96FE}, {23, 10, 0x769D}, {23, 11, 0x57D}, {23, 12, 0x55D}, {23, 13, 0x5E1D}, {24, 9, 0xD79E}, {24, 10, 0xD5C}, 
	{24, 11, 0x55E}, {24, 12, 0x259C}, {24, 13, 0xE7BF}, {25, 9, 0xB73D}, {25, 10, 0x5E3C}, {25, 11, 0x5E3D}, {25, 12, 0xB75E}
};

const int numberImages[10][10 * 14] = {
    // 0
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 1
    {
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff
    },
    // 2
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 3
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 4
    {
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0x0000, 0xffff, 0x0000, 0x0000, 0x0000, 0xffff, 0x0000, 0xffff,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 5
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 6
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 7
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 8
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 9
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    }
};
static void _Delay(int ms)
{
	volatile int i;
	for(i=0;i<(0x1000*ms);i++);
}

void Generate_Missile(GameObject *missile)
{
    missile->x = 320;
    missile->y = rand() % (Lcd_H - 10);
    missile->width = MISSILE_W;
    missile->height = MISSILE_H;
    missile->image = Plane;
}

void Draw_Image(GameObject *obj, int size) {
	Lcd_Set_Windows(obj->x, obj->y, obj->x + obj->width - 1, obj->y + obj->height - 1);

	int i=0, j=0;

	for (;i<size;i++) {
		Lcd_Put_Pixel(obj->image[i][0], obj->image[i][1], obj->image[i][2]);
	}
}

void Clear_Image(int x, int y, int w, int h, unsigned short Color) {
	Lcd_Set_Windows(x, y, x + w - 1, y + h - 1);

	int i=0, j=0;

	for (;i < w; i++) {
		j = 0;
		for (;j<h;j++){
			Lcd_Put_Pixel(x+i, y+j, Color);
		}
	}
}
void DrawPlane(void){
	Lcd_Set_Windows(plane.x, plane.y, plane.x + PLANE_W - 1, plane.y + PLANE_H - 1);

	int i=0;

	for (;i<PLANE_SIZE;i++) {
		Lcd_Put_Pixel(plane.x+Plane[i][0], plane.y+Plane[i][1], Plane[i][2]);
	}
}
void ClearPlane(void){
	Clear_Image(before_plane_x, before_plane_y, PLANE_W, PLANE_H, BLACK);
}
void DrawMissile(GameObject* missile){
	Draw_Image(missile, MISSILE_SIZE);
}
void ClearMissile(GameObject* missile){
	Clear_Image(missile->x, missile->y, MISSILE_W, MISSILE_H, BLACK);
}

void Game_Init(void)
{
    initQueue(&missile_queue);
	initQueue(&delete_missile_queue);

	Lcd_Clr_Screen();

    // Initialize plane
    plane.x = 20;
    plane.y = Lcd_H/2 - PLANE_H/2;
	plane.width = PLANE_W;
	plane.height = PLANE_H;
	plane.image = Plane;

	before_plane_x = 0;
	before_plane_y = 0;

	score = 0;
    game_over = 0;
	game_level = 2;
	game_state_flag = GAME_PLAYING;
	plane_move_flag = 1;
}

void Game_Plane_Move(int dir)
{
	int dx = 10;
	int dy = 10;

	plane_move_flag = 1;

	before_plane_x = plane.x;
	before_plane_y = plane.y;

	switch(dir){ //1-left, 2-right, 3-down, 4-up
		case 1:
			if(plane.y >= 15) plane.y -= dy;
			break;
		case 2:
			if(plane.y <= 200) plane.y += dy;
			break;
		case 3:
			if(plane.x >= 15) plane.x -= dx;
			break;
		case 4:
			if(plane.x <= 300) plane.x += dx;
			break;
	}
}

void Game_Missile_Generation(void)
{
    if(queueSize(&missile_queue)<level_max_missiles[game_level]){
    	GameObject newMissile;
    	Generate_Missile(&newMissile);
    	enqueue(&missile_queue, newMissile);
    }
}

void Game_Missile_Move(void)
{
	int index = missile_queue.front;
	int count = missile_queue.size;

	int dx = -level_px_move[game_level];
	int i = 0;

	for (; i < count; i++) {
		GameObject *mis = &missile_queue.queue[index];

		GameObject delMissile;
		delMissile.x = mis->x;
		delMissile.y = mis->y;
		delMissile.width = MISSILE_W;
		delMissile.height = MISSILE_H;
		delMissile.image = Missile;

		enqueue(&delete_missile_queue, delMissile);

		mis->x += dx;

		if (mis->x < plane.x + plane.width &&
			mis->x + mis->width > plane.x &&
			mis->y < plane.y + plane.height &&
			mis->y + mis->height > plane.y) {
			
			game_state_flag = GAME_OVER;
		}

		if (mis->x <= 0) {
			GameObject temp;
			dequeue(&missile_queue, &temp);
			score += level_score[game_level];
		}
		else {
			index = (index + 1) % QUEUE_MAX_SIZE;
		}
	}
}

void Draw_LCD(void)
{
	int index, count, i;

	if(game_state_flag==GAME_START){
		Lcd_Draw_Back_Color(BLUE);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
	else if(game_state_flag==GAME_PLAYING){
		index = missile_queue.front;
		count = missile_queue.size;
		i = 0;

		while(!isQueueEmpty(&delete_missile_queue)){
			GameObject temp;
			dequeue(&delete_missile_queue, &temp);

			ClearMissile(&temp);
		}
		for (; i < count; i++) {
			GameObject *mis = &missile_queue.queue[index];

			DrawMissile(mis);
			
			index = (index + 1) % QUEUE_MAX_SIZE;
		}

		if(plane_move_flag) {
			ClearPlane();
			DrawPlane();

			plane_move_flag = 0;
		}
	}
	else if(game_state_flag==GAME_OVER){
		Lcd_Draw_Back_Color(RED);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
}

void Play_BGM(void)
{
	int index, count, i;
	if(game_state_flag==GAME_START){
		Lcd_Draw_Back_Color(BLUE);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
	else if(game_state_flag==GAME_PLAYING){
		DrawPlane();
	}
	else if(game_state_flag==GAME_OVER){
		Lcd_Draw_Back_Color(RED);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
}

void intToStr(int score, char *str) {
    int i = 0;
    int isNegative = 0;

    // 점수가 0인 경우 처리
    if (score == 0) {
        str[i++] = '0';
        str[i] = '\0';
        return;
    }

    // 음수 점수 처리
    if (score < 0) {
        isNegative = 1;
        score = -score;
    }

    // 점수를 문자열로 변환
    while (score != 0) {
        int digit = score % 10;
        str[i++] = digit + '0';
        score /= 10;
    }

    // 음수 부호 추가
    if (isNegative) {
        str[i++] = '-';
    }

    // 문자열 끝에 null 추가
    str[i] = '\0';

    // 문자열 뒤집기
    int len = i; // i는 현재 문자열의 길이
    int j;
    for (j = 0; j < len / 2; j++) {
        char temp = str[j];
        str[j] = str[len - 1 - j];
        str[len - 1 - j] = temp;
    }
}


void drawDigit(int x, int y, int digit) {
    if (digit < 0 || digit > 9) return; // �좏슚�섏� �딆� �レ옄 踰붿쐞 臾댁떆
    //Draw_Image(x, y, DIGIT_WIDTH, DIGIT_HEIGHT, &numberImages[digit]);
}

// �먯닔瑜�臾몄옄�대줈 蹂�솚�섏뿬 媛��먮┸�섎퀎濡��대�吏�줈 洹몃━���⑥닔
void drawScore(int x, int y, int score) {
    char scoreStr[10];
    intToStr(score, scoreStr);
    Uart_Printf("score %d", score);
    int offsetX = 0;
    char *p;
    int i;
    for (p = scoreStr; *p != '\0'; p++) {
        int digit = *p - '0';
        Uart_Printf("- %d", digit);

        drawDigit(x + offsetX, y, digit);
        offsetX += DIGIT_WIDTH + 1; // �レ옄 媛�媛꾧꺽
    }
}