/*
 * lcd_test.c
 *
 *  Created on: 2024. 7. 16.
 *      Author: yeeun99.kim
 */

#include "device_driver.h"
#include "lcd.h"
#include "lcd_test.h"
#include "game_object_queue.h"

#define Lcd_W 				320
#define Lcd_H 				240

#define Plane_W 			30
#define Plane_H 			30

#define MISSILE_W			8
#define MISSILE_H			8

#define GAME_START			0
#define GAME_PLAYING		1
#define GAME_OVER			2

GameObject plane;

#define DIGIT_WIDTH 10
#define DIGIT_HEIGHT 14

GameObjectQueue missile_queue;
GameObjectQueue delete_missile_queue;

int score = 0;
int game_over = 0;
int game_level = 0;
int game_state_flag = 1;
int plane_move_flag = 0;

int level_delay[3] = {500, 300, 120};
int level_px_move[3] = {1, 3, 5};
int level_score[3] = {10, 30, 50};
int level_max_missiles[3] = {5, 10, 15};

extern volatile int key_value;

void Generate_Missile(GameObject *missile);
void Draw_Image(int x, int y, int w, int h, const int *image);
void Clear_Image(int x, int y, int w, int h, unsigned short Color);
void DrawPlane(void);
void ClearPlane(void);
void DrawMissile(GameObject* missile);
void ClearMissile(GameObject* missile);
void Game_Init(void);
void Game_Plane_Move(int dir);
void Game_Missile_Generation(void);
void Game_Missile_Move(void);
void Game_Over(void);
void Draw_LCD(void);
void Play_BGM(void);
void intToStr(int score, char *str);
void drawDigit(int x, int y, int digit);
void drawScore(int x, int y, int score);


const int Missile[MISSILE_W * MISSILE_H] = {
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFBE4, 0xFBE4, 0x0000, 0x0000, 0x0000,
		0x0000, 0x0000, 0xFBE4, 0xFBE4, 0xFBE4, 0xFBE4, 0x0000, 0x0000, 0x0000, 0xFBE4, 0xFBE4, 0x0000, 0x0000, 0xFBE4, 0xFBE4, 0x0000,
		0x0000, 0xFBE4, 0xFBE4, 0x0000, 0x0000, 0xFBE4, 0xFBE4, 0x0000, 0x0000, 0x0000, 0xFBE4, 0xFBE4, 0xFBE4, 0xFBE4, 0x0000, 0x0000,
		0x0000, 0x0000, 0x0000, 0xFBE4, 0xFBE4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

const int Plane[Plane_W * Plane_H] = {
  		// �̹��� ������ �迭
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0xB73D, 0x5E3C, 0x5E3D, 0xB75E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xD79E, 
		0x0D5C, 0x055E, 0x259C, 0xE7BF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x769D, 0x057D, 
		0x055D, 0x5E1D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xDFBF, 0x159D, 0x05BE, 0x055D, 
		0x96FE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x767D, 0x055E, 0x059D, 0x157D, 0xCF9F, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xDFBF, 0x159D, 0x059E, 0x057D, 0x45FD, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC73D, 0x4DDB, 
		0x8EDD, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x769E, 0x053D, 0x05BE, 0x055D, 0x7E9E, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xD7BF, 0x0D5D, 0x053D, 0x96DD, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xD7BF, 0x157C, 0x057E, 0x059E, 0x057D, 0xBF5F, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x667D, 0x055E, 0x0D7D, 0xA73E, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7EDE, 0x055D, 0x0D9D, 0x059D, 0x2DBD, 0xEFDF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xBF5E, 0x0D5D, 0x059E, 0x157D, 0x6E5D, 0x767D, 0x765C, 
		0x6E7C, 0x6E7C, 0x7E7C, 0x563D, 0x057E, 0x059E, 0x057F, 0x055D, 0x45FD, 0x767C, 0x765D, 0x765D, 0x765D, 0x765D, 0x767D, 0x8EBD, 
		0xD79E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3DFD, 0x057D, 0x059E, 0x055E, 0x055D, 0x055D, 0x055D, 0x055E, 
		0x055D, 0x057E, 0x057D, 0x059D, 0x059D, 0x059E, 0x057D, 0x055E, 0x055D, 0x055D, 0x055D, 0x055D, 0x055D, 0x057D, 0x155C, 0xAF1E, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3DFD, 0x057D, 0x059E, 0x055E, 0x055D, 0x055D, 0x055D, 0x055E, 0x055D, 0x057E, 
		0x057D, 0x059D, 0x059D, 0x059E, 0x057D, 0x055E, 0x055D, 0x055D, 0x055D, 0x055D, 0x055D, 0x057D, 0x0D3C, 0xAF1E, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0xBF5F, 0x0D5D, 0x059E, 0x157D, 0x6E5D, 0x767D, 0x765C, 0x6E7C, 0x6E7C, 0x7E7C, 0x563D, 0x057E, 0x059E, 
		0x057F, 0x055D, 0x45FD, 0x767C, 0x765D, 0x765D, 0x765D, 0x765D, 0x767D, 0x8EBD, 0xD79E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x667D, 0x055E, 0x0D5D, 0xA73E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7EDE, 0x055D, 0x0D9D, 0x059D, 0x2DBC, 
		0xEFDF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xD7BF, 0x0D5D, 
		0x053D, 0x96DD, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xD7BF, 0x157C, 0x057E, 0x059E, 0x057D, 0xBF5F, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC73D, 0x4DDB, 0x8EDD, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x769E, 0x053D, 0x05BE, 0x055D, 0x7E9E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0xDFBF, 0x159D, 0x059E, 0x057D, 0x45FD, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x767D, 0x055E, 0x059D, 0x157D, 0xCF9F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xDFBF, 0x159D, 
		0x05BE, 0x055D, 0x96FE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x769D, 0x057D, 0x055D, 0x5E1D, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xD79E, 0x0D5C, 0x055E, 0x259C, 0xE7BF, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xB73D, 0x5E3C, 0x5E3D, 0xB75E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
		0x0000, 0x0000, 0x0000, 0x0000
};

const int numberImages[10][10 * 14] = {
    // 0
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 1
    {
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0x0000, 0xffff, 0xffff
    },
    // 2
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 3
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0xffff, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 4
    {
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0x0000, 0xffff, 0x0000, 0x0000, 0x0000, 0xffff, 0x0000, 0xffff,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 5
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 6
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 7
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 8
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    },
    // 9
    {
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff, 0xffff,
        0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0xffff,
        0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff
    }
};
static void _Delay(int ms)
{
	volatile int i;
	for(i=0;i<(0x1000*ms);i++);
}

void Generate_Missile(GameObject *missile)
{
    missile->x = 320;
    missile->y = rand() % (Lcd_H - 10);
    missile->width = MISSILE_W;
    missile->height = MISSILE_H;
    missile->image = Missile;
}

void Draw_Image(int x, int y, int w, int h, const int *image) {
	Lcd_Set_Windows(x, y, x + w - 1, y + h - 1);

	int i=0, j=0;

	for (;i<h;i++) {
		j = 0;
		for (;j<w;j++){
			Lcd_Put_Pixel(x+j, y+i, image[w*i+j]);
		}
	}
}

void Clear_Image(int x, int y, int w, int h, unsigned short Color) {
	Lcd_Set_Windows(x, y, x + w - 1, y + h - 1);

	int i=0, j=0;

	for (;i < w; i++) {
		j = 0;
		for (;j<h;j++){
			Lcd_Put_Pixel(x+i, y+j, Color);
		}
	}
}
void DrawPlane(void){
	Draw_Image(plane.x, plane.y, plane.width, plane.height, plane.image);
}
void ClearPlane(void){
	Clear_Image(plane.x, plane.y, plane.width, plane.height, BLACK);
}
void DrawMissile(GameObject* missile){
	Draw_Image(missile->x, missile->y, missile->width, missile->height, missile->image);
}
void ClearMissile(GameObject* missile){
	Clear_Image(missile->x, missile->y, missile->width, missile->height, BLACK);
}

void Game_Init(void)
{
    initQueue(&missile_queue);
	Lcd_Clr_Screen();

    // Initialize plane
    plane.x = 20;
    plane.y = Lcd_H/2 - Plane_H/2;
	plane.width = Plane_W;
	plane.height = Plane_H;
	plane.image = Plane;

	DrawPlane();

	score = 0;
    game_over = 0;
	game_level = 2;
	game_state_flag = GAME_PLAYING;
}

void Game_Plane_Move(int dir)
{
	int dx = 10;
	int dy = 10;

	plane_move_flag = 1;

	switch(dir){ //1-left, 2-right, 3-down, 4-up
		case 1:
			if(plane.y >= 15) plane.y -= dy;
			break;
		case 2:
			if(plane.y <= 200) plane.y += dy;
			break;
		case 3:
			if(plane.x >= 15) plane.x -= dx;
			break;
		case 4:
			if(plane.x <= 300) plane.x += dx;
			break;
	}

	//_Delay(120); //speed control
}

void Game_Missile_Generation(void)
{
    if(queueSize(&missile_queue)<level_max_missiles[game_level]){
    	GameObject newMissile;
    	Generate_Missile(&newMissile);
    	enqueue(&missile_queue, newMissile);
    }
}

void Game_Missile_Move(void)
{
	int index = missile_queue.front;
	int count = missile_queue.size;

	int dx = -level_px_move[game_level];
	int i = 0;

	for (; i < count; i++) {
		GameObject *obj = &missile_queue.queue[index];

		ClearMissile(obj);

		obj->x += dx;

		if (obj->x < plane.x + plane.width &&
			obj->x + obj->width > plane.x &&
			obj->y < plane.y + plane.height &&
			obj->y + obj->height > plane.y) {
			
			game_state_flag = GAME_OVER;
		}

		if (obj->x <= 0) {
			GameObject temp;
			dequeue(&missile_queue, &temp);
			score += level_score[game_level];
		}
		else {
			DrawMissile(obj);
			index = (index + 1) % QUEUE_MAX_SIZE;
		}
	}
}

void Draw_LCD(void)
{
	int index, count, i;
	if(game_state_flag==GAME_START){
		Lcd_Draw_Back_Color(BLUE);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
	else if(game_state_flag==GAME_PLAYING){

		for(; i < count; i++) {
			GameObject *obj = &missile_queue.queue[index];

			
			DrawMissile(obj);
			index = (index + 1) % QUEUE_MAX_SIZE;
		}
	}
	else if(game_state_flag==GAME_OVER){
		Lcd_Draw_Back_Color(RED);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
}

void Play_BGM(void)
{
	int index, count, i;
	if(game_state_flag==GAME_START){
		Lcd_Draw_Back_Color(BLUE);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
	else if(game_state_flag==GAME_PLAYING){
		DrawPlane();
	}
	else if(game_state_flag==GAME_OVER){
		Lcd_Draw_Back_Color(RED);
		_Delay(300);
		Lcd_Clr_Screen();
		_Delay(300);
	}
}

void intToStr(int score, char *str) {
    int i = 0;
    int isNegative = 0;

    // 점수가 0인 경우 처리
    if (score == 0) {
        str[i++] = '0';
        str[i] = '\0';
        return;
    }

    // 음수 점수 처리
    if (score < 0) {
        isNegative = 1;
        score = -score;
    }

    // 점수를 문자열로 변환
    while (score != 0) {
        int digit = score % 10;
        str[i++] = digit + '0';
        score /= 10;
    }

    // 음수 부호 추가
    if (isNegative) {
        str[i++] = '-';
    }

    // 문자열 끝에 null 추가
    str[i] = '\0';

    // 문자열 뒤집기
    int len = i; // i는 현재 문자열의 길이
    int j;
    for (j = 0; j < len / 2; j++) {
        char temp = str[j];
        str[j] = str[len - 1 - j];
        str[len - 1 - j] = temp;
    }
}


void drawDigit(int x, int y, int digit) {
    if (digit < 0 || digit > 9) return; // �좏슚�섏� �딆� �レ옄 踰붿쐞 臾댁떆
    Draw_Image(x, y, DIGIT_WIDTH, DIGIT_HEIGHT, &numberImages[digit]);
}

// �먯닔瑜�臾몄옄�대줈 蹂�솚�섏뿬 媛��먮┸�섎퀎濡��대�吏�줈 洹몃━���⑥닔
void drawScore(int x, int y, int score) {
    char scoreStr[10];
    intToStr(score, scoreStr);
    Uart_Printf("score %d", score);
    int offsetX = 0;
    char *p;
    int i;
    for (p = scoreStr; *p != '\0'; p++) {
        int digit = *p - '0';
        Uart_Printf("- %d", digit);

        drawDigit(x + offsetX, y, digit);
        offsetX += DIGIT_WIDTH + 1; // �レ옄 媛�媛꾧꺽
    }
}